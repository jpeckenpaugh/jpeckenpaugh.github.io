<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Lokarta Web Demo</title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Mono:wght@400;600&display=swap" rel="stylesheet" />
    <link rel="stylesheet" href="https://unpkg.com/xterm@5.3.0/css/xterm.css" />
    <link rel="stylesheet" href="style.css" />
    <script src="https://cdn.jsdelivr.net/pyodide/v0.29.2/full/pyodide.js"></script>
    <script src="https://unpkg.com/xterm@5.3.0/lib/xterm.js"></script>
  </head>
  <body>
    <div id="tips-modal" class="modal hidden" role="dialog" aria-modal="true" aria-labelledby="tips-title">
      <div class="modal-card">
        <div class="modal-title" id="tips-title">Quick Start</div>
        <div class="modal-body">
          <p>
            If you are playing on PC/Mac, don't forget to click inside the terminal window to capture the cursor,
            then you can use A, S, Enter, and the Arrow keys on your keyboard to play.
          </p>
          <p>
            If you are playing on Mobile, it may be easier to use the Virtual Keyboard below.
          </p>
          <div class="modal-note-title">Browser Note</div>
          <p>
            This demo runs the Python game code in your browser using Pyodide, which executes
            Python inside JavaScript. To keep the port simple and faithful to the original,
            the game loop currently runs on the main thread. That works well in Google Chrome
            on PC, Mac, and Android.
          </p>
          <p>
            On iOS, all browsers use Apple's WebKit engine, which is more restrictive with
            long-running main-thread work. As a result, iOS browsers (including Safari and
            Chrome on iOS) may freeze or become unresponsive during gameplay. If you're viewing
            this page in Safari and it feels stuck, that is likely the cause.
          </p>
        </div>
        <label class="modal-check">
          <input id="tips-dismiss" type="checkbox" />
          Do not show this again
        </label>
        <div class="modal-actions">
          <button id="tips-close" class="modal-btn" type="button">Continue</button>
        </div>
      </div>
    </div>
    <main class="page">
      <section class="terminal-shell">
        <div id="terminal" class="terminal"></div>
        <div id="status" class="status">Loading runtime...</div>
      </section>
      <section class="keyboard-shell">
        <div class="keyboard-title">Virtual Keyboard</div>
        <div id="virtual-keyboard" class="keyboard-grid">
          <div class="pad-controls">
            <div class="action-pad">
              <button class="key key-action key-action-a" data-key="A">A</button>
              <button class="key key-action key-action-s" data-key="S">S</button>
              <button class="key key-enter" data-key="ENTER">Enter</button>
            </div>
            <div class="arrow-pad">
              <div class="arrow-row arrow-row-single">
                <button class="key key-arrow" data-key="UP">↑</button>
              </div>
              <div class="arrow-row">
                <button class="key key-arrow" data-key="LEFT">←</button>
                <button class="key key-arrow" data-key="RIGHT">→</button>
              </div>
              <div class="arrow-row arrow-row-single">
                <button class="key key-arrow" data-key="DOWN">↓</button>
              </div>
            </div>
          </div>
        </div>
      </section>
      <footer class="page-footer">
        <div class="footer-links">
          <div class="docs-menu-wrap">
            <button id="docs-open" class="debug-link" type="button" aria-expanded="false" aria-controls="docs-menu">
              Docs
            </button>
            <div id="docs-menu" class="docs-menu hidden" role="menu" aria-label="Documentation links">
              <a class="docs-item" href="marked/?file=README.md" role="menuitem">
                <span class="docs-title">README</span>
                <span class="docs-desc">Project overview and quick start.</span>
              </a>
              <a class="docs-item" href="marked/?file=AGENTS.md" role="menuitem">
                <span class="docs-title">AGENTS</span>
                <span class="docs-desc">Contributor guidelines and workflows.</span>
              </a>
              <a class="docs-item" href="marked/?file=testing_feedback.md" role="menuitem">
                <span class="docs-title">Testing Feedback</span>
                <span class="docs-desc">QA notes and testing results.</span>
              </a>
              <a class="docs-item" href="marked/?file=todo_controls.md" role="menuitem">
                <span class="docs-title">TODO: Controls</span>
                <span class="docs-desc">Input and control scheme backlog.</span>
              </a>
              <a class="docs-item" href="marked/?file=TODO_elements.md" role="menuitem">
                <span class="docs-title">TODO: Elements</span>
                <span class="docs-desc">Element system tasks and notes.</span>
              </a>
              <a class="docs-item" href="marked/?file=todo_opponent_rework.md" role="menuitem">
                <span class="docs-title">TODO: Opponents</span>
                <span class="docs-desc">Opponent rework backlog.</span>
              </a>
              <a class="docs-item" href="marked/?file=todo_testing.md" role="menuitem">
                <span class="docs-title">TODO: Testing</span>
                <span class="docs-desc">Testing checklist and coverage.</span>
              </a>
              <a class="docs-item" href="marked/?file=todo_venues.md" role="menuitem">
                <span class="docs-title">TODO: Venues</span>
                <span class="docs-desc">Venue updates and fixes.</span>
              </a>
            </div>
          </div>
          <a class="repo-link" href="https://github.com/jpeckenpaugh/lokarta" target="_blank" rel="noopener noreferrer">
            GitHub: jpeckenpaugh/lokarta
          </a>
          <button id="debug-open" class="debug-link" type="button">Debug</button>
        </div>
        <div class="footer-meta">
          <span id="build-time" class="build-time" aria-live="polite"></span>
        </div>
      </footer>
    </main>
    <div id="debug-modal" class="modal hidden" role="dialog" aria-modal="true" aria-labelledby="debug-title">
      <div class="modal-card">
        <div class="modal-title" id="debug-title">Debug</div>
        <div class="modal-body">
          <p>
            This project is under rapid development, and backwards-incompatible changes may land on the
            main branch regularly. These updates can include changes to the shape of JSON save data files,
            which may lead to odd or unpredictable behavior when loading older saves.
          </p>
          <p>
            You can clear your browser saves to get a clean state that is more compatible with the latest
            code. This will permanently remove your saved games on this site.
          </p>
          <p>
            If you want to explore the engine without worrying about losing game state in this way, you can
            clone the repo locally, run it with Python, and choose when (or if) to pull updates. This GitHub
            Pages site auto-deploys every change pushed to the main branch.
          </p>
        </div>
        <div class="modal-actions modal-actions-split">
          <button id="debug-clear" class="modal-btn" type="button">Clear Saved Games</button>
          <button id="debug-close" class="modal-btn" type="button">Close</button>
        </div>
      </div>
    </div>
    <script type="module" src="audio.js"></script>
    <script type="module" src="main.js"></script>
  </body>
</html>
